---
title: "Species Distribution Modeling in R"
author: "Sode A.I, Olajide A.Y, Nakhwala L, Opara A, Opoku M, Barasa C.W"
date: "2024-09-25"
output:
  html_document: default
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This tutorial present the workflow to build a Species Distribution Model (SDM) for *Bidens bipinnata*, the most abundant introduced species in Fogo island. 

We used **RMarkdown** which is a simple formatting syntax for authoring HTML, PDF, and MS Word documents (see <http://rmarkdown.rstudio.com>). When you click the **Knit** button, a document will be generated that includes both content as well as the output of any embedded R code chunks within the document.

Two types of data are used to build SDM for *B. bipinnata*: occurrence and environmental data. The **occurrence data** are constituted of geographical coordinates (longitude and latitude) of the species. The **environmental data** represent descriptors of the environment, and can include abiotic measurements such as temperature, precipitation, soil types, land cover as well as biotic factors, such as the presence or absence of other species (like predators, competitors, or food sources). In this tutorial, we will focus on climate data.


## Data preparation

Loading required R packages

```{r, echo=FALSE}
library(terra)
library(geodata)
library(predicts)
```

### Climate data

First we are going to download the climate data from the `Worldclim` website <https://www.worldclim.org/>


```{r}
# the path where the data should be stored
data_path <- "env_data/climate/wc2.1_2.5m" 

# Check if the data already exists
if (!file.exists(data_path)) {
  # data does not exist, download it
  message("Climate data not found, downloading...")
  bioclim_data <- worldclim_global(var = "bio",
                                   res = 2.5,
                                   path = "data/")
} else {
  # data exists, load it or proceed
  message("Climate data already exists, proceeding...")
  #bioclim_data <- raster::stack(list.files(data_path, pattern = "\\.bil$", full.names = TRUE))
}
```

### Occurrence data

After downloading the environmental data that will be use as covariates in the SDM, we can load the occurrence data.

```{r}
obs_data <- read.csv(file = "occ_data/Bidens_bipinnata.csv")
head(obs_data)
```

After loading the data, we get an overview about it
```{r}
summary(obs_data)
```

We drop NAs and make sure they went way before proceeding

```{r}
obs_data <- obs_data[!is.na(obs_data$latitude), ]
summary(obs_data)
```

Now, we determine the geographic extent of our data and store it in a single object

```{r}
# Determine geographic extent of our data
max_lat <- ceiling(max(obs_data$latitude))
min_lat <- floor(min(obs_data$latitude))
max_lon <- ceiling(max(obs_data$longitude))
min_lon <- floor(min(obs_data$longitude))

# Store boundaries in a single extent object
geographic_extent <- ext(x = c(min_lon, max_lon, min_lat, max_lat))
```

Also, we need to download the world map to use for our base map
```{r}
# Download data with geodata's world function to use for our base map
world_map <- world(resolution = 3,
                   path = "data/")

```

